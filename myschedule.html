<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>MyToolkit</title>
    <link rel="stylesheet" href="./assets/style.css">
    <script src="./assets/js/schedules/swap.js"></script>
    <script>side="class";</script>
  </head>
  <body class = "elseBody" onload="resize();">
    <!-- Navbar at the top -->
    <img src = "./assets/svg/logo_yellow.svg" id = "navbar0" onclick = "showSidebar();" width = "54.5" height = "54.5" class = "logo" style="top: 32px; left: 17px;">
    <div class = "navbar" id = "navbar1" onclick = "showSidebar();" style = "top: 37px; left: 89px;">MYTOOLKIT</div>
    <div class = "navbar" id = "navbar2" style = "top: 37px; left: 1168px;opacity: 1;" onclick="window.location = './schedules.html'">SCHEDULE</div>
    <div class = "navbar" id = "navbar2" style = "top: 37px; left: 944px;opacity: 0.25;" onclick="window.location = './myschedule.html'">CLASSMATES</div>
    <div class = "navbar" id = "navbar3" style = "top: 37px; left: 1360px;" onclick="window.location = './login.html';">LOGIN</div>
    <!-- Navbar at the top -->

    <!-- Main -->
    <img src = "./assets/svg/schedulecompare_main.svg" id = "classmates0" width = "445" height = "auto" class = "scheduleTop" style = "top: 154px; left:548px">
    <img src = "./assets/svg/classbar.svg" id = "per1classbar" width="343" height="auto" class="scheduleTop" style="top: 254px; left: 597px;opacity:0.25;">
    <img src = "./assets/svg/classbar.svg" id = "per2classbar" width="343" height="auto" class="scheduleTop" style="top: 345px; left: 597px;opacity:0.25;">
    <img src = "./assets/svg/classbar.svg" id = "per3classbar" width="343" height="auto" class="scheduleTop" style="top: 436px; left: 597px;opacity:0.25;">
    <img src = "./assets/svg/classbar.svg" id = "per4classbar" width="343" height="auto" class="scheduleTop" style="top: 527px; left: 597px;opacity:0.25;">
    <img src = "./assets/svg/classbar.svg" id = "per5classbar" width="343" height="auto" class="scheduleTop" style="top: 618px; left: 597px;opacity:0.25;">

    <div class = "scheduleTextMid" id="number" style="top:173px;left:665px">3 Classes</div>
    <div class = "scheduleTextSmall" id="per1" style="text-align: center;left: 625px;top:265px;opacity:0.25;">AP Calculus</div>
    <div class = "scheduleTextSmall" id="per2" style="text-align: center;left: 625px;top:356px;opacity:0.25;">AP Biology</div>
    <div class = "scheduleTextSmall" id="per3" style="text-align: center;left: 625px;top:447px;opacity:0.25;">Honors Humanities</div>
    <div class = "scheduleTextSmall" id="per4" style="text-align: center;left: 625px;top:538px;opacity:0.25;">AP Chinese</div>
    <div class = "scheduleTextSmall" id="per5" style="text-align: center;left: 625px;top:629px;opacity:0.25;">AP Comp Sci P</div>
    <div class = "scheduleCardNumbersMid" id="mid1" style="top:293px; left:410px;opacity:0.5;">2</div>
    <div class = "scheduleCardNumbersMid" id="mid2" style="top:293px; left:1026px;opacity:0.5;">4</div>
    <div class = "scheduleCardNumbersBot" id="bot1" style="top:322px; left:247px;opacity:0.25;">3</div>
    <div class = "scheduleCardNumbersBot" id="bot2" style="top:322px; left:1217px;opacity:0.25;">1</div>
    <div class = "scheduleTextBig" id="classmates0" style="top:736px;left:615px">Student 1</div>

    <img src = "./assets/svg/schedulecompare_mid.svg" id = "classmates0" width = "356" height = "auto" class = "scheduleMid" style = "top: 210px; left:902px">
    <img src = "./assets/svg/schedulecompare_mid.svg" id = "classmates0" width = "356" height = "auto" class = "scheduleMid" style = "top: 210px; left:282px">
    <img src = "./assets/svg/schedulecompare_back.svg" id = "classmates0" width = "266" height = "auto" class = "scheduleBot" style = "top: 258px; left:149px">
    <img src = "./assets/svg/schedulecompare_back.svg" id = "classmates0" width = "266" height = "auto" class = "scheduleBot" style = "top: 258px; left:1122px">
    <!-- Main -->

    </body>
    <script src="./assets/js/animations.js"></script>
    <script>
        function compare(a, b, json) {
          classesA = json[a];
          classesB = json[b];
          matches = 0
          for (i=1; i<6; i++) {
              clss="per" + i;
              teach = "teach" + i;
              classA=(classesA[clss] + ":" + classesA[teach])
              classB=(classesB[clss] + ":" + classesB[teach])
              if (classA == classB) {
                  matches += 1
                  console.log("Match found!" + classA + " = " + classB)
              }
          }
          return matches
        }
        function exactMatches(a, b, json) {
          classesA = json[a];
          classesB = json[b];
          matches = []
          for (i=1; i<6; i++) {
              clss="per" + i;
              teach = "teach" + i;
              classA=(classesA[clss] + ":" + classesA[teach])
              classB=(classesB[clss] + ":" + classesB[teach])
              if (classA == classB) {
                  matches.push(classesA[clss])
              }
          }
          return matches
        }
        function getCookie(cname) {
        let name = cname + "=";
        let decodedCookie = decodeURIComponent(document.cookie);
        let ca = decodedCookie.split(';');
        for(let i = 0; i <ca.length; i++) {
          let c = ca[i];
          while (c.charAt(0) == ' ') {
            c = c.substring(1);
          }
          if (c.indexOf(name) == 0) {
            return c.substring(name.length, c.length);
          }
        }
        return "";
      }
      function update_display() {
        // prepare fetch options
        let id = getCookie("id")
        console.log(id)
        const read_options = {
          method: 'GET', // *GET, POST, PUT, DELETE, etc.
          mode: 'cors', // no-cors, *cors, same-origin
          cache: 'default', // *default, no-cache, reload, force-cache, only-if-cached
          credentials: 'omit', // include, *same-origin, omit
          headers: {
            'Content-Type': 'application/json'
          },
        };

        // fetch the data from API
        fetch("https://seal.nighthawkcodingsociety.com/api/users/schedules", read_options)
          // response is a RESTful "promise" on any successful fetch
          .then(response => {
            // check for response errors
            if (response.status !== 200) {
                const errorMsg = 'Database read error: ' + response.status;
                console.log(errorMsg);
                return;
            }
            // valid response will have json data
            response.json().then(data => {
                for (let i = 0; i<data.length; i++) {
                    if (i == 0) {
                      number = compare(id, i, data)
                      document.getElementById("number").innerHTML = number + " Classes";
                      sameClasses = exactMatches(id, i, data)
                      console.log(sameClasses)
                      for (j = 0; j < 5; j++) {
                        clss="per" + (j+1);
                        period = data[0][clss]
                        id = "per" + (j+1)
                        id2 = "per" + (j+1) + "classbar"
                        document.getElementById(id).innerHTML = period
                        if (sameClasses.includes(period)) {
                          console.log("true")
                          document.getElementById(id).style.opacity = "1";
                          document.getElementById(id2).style.opacity = "1";
                        }
                      }
                    } else if (i == 1 || i == 2) {
                        if (i == 1) {
                            number = compare(id, i, data)
                            document.getElementById("mid1").innerHTML = string;
                        }
                        if (i == 2) {
                            number = compare(id, i, data)
                            document.getElementById("mid2").innerHTML = string;
                        }
                    } else if (i == 3 || i == 4) {
                        if (i == 3) {
                            number = compare(id, i, data)
                            document.getElementById("bot1").innerHTML = string;
                        }
                        if (i == 4) {
                            number = compare(id, i, data)
                            document.getElementById("bot2").innerHTML = string;
                        }
                    }
                }
            })
        })
        // catch fetch errors (ie ACCESS to server blocked)
        .catch(err => {
          console.error(err);
        });
      }
      update_display()
    </script>
</html>